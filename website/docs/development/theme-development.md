---
sidebar_position: 1
---

# Theme development

Cromwell CMS follows principles of headless CMS where API server runs separately from its frontend server. So basically you can create any type of frontend and host it wherever you like. But in this scenario you need to manage and deploy this frontend by yourself.  
Cromwell CMS provides a way to build Themes that are managed and work with the CMS core. CMS users can easily install Themes from official market right in their Admin panel GUI, make active, delete them, change layout in the Page Builder as long as Themes follow guidelines we are going to show.  

Cromwell CMS Theme is a Next.js app. Theme development is basically Next.js development. If you are not familiar with Next.js, [you should definitely start with it first](https://nextjs.org/docs/getting-started).   


### Create a project

As in [Installation](/docs/overview/installation#4-cromwell-cli), Cromwell CLI can create a new project template. If you want to create Theme use `--type theme` argument or `--type plugin` for Plugin.  
```sh
npx @cromwell/cli create --type theme my-theme-name
```

### Project structure

- **`src/pages`** - Directory for Next.js pages. By default there's `index.tsx` created by CLI. You can rename it to .jsx if you don't want to work with Typescript (which is discouraged).
- **`static`** - Directory for static files your theme will use. Files from this directory will be copied into `public` directory of the CMS on Theme/Plugin installation/update.  
Your files in the `public` will have a path that follows the pattern: `/themes/${packageName}/${pathRelativelyStaticDir}`.  
Image example:  `<img src="/themes/@cromwell/theme-store/free_shipping.png" />`
- **`cromwell.config.js`** - [Config file for your Theme/Plugin.](/docs/development/module-config)  


### Compile

To make Theme work with the CMS we need to run an additional [pre-build phase](#pre-build-phase). With that you cannot directly use Next.js CLI, but Cromwell CLI has a replacement which works in a similar way.  
To start development server with watcher (same as `next dev`):
```
npx cromwell build -w
```
Open [http://localhost:4256/](http://localhost:4256/) to see your website.  
You may also need to start the CMS to retrieve data from API server:
```
npx cromwell start --detached 
```
Or via shortcut:
```
npx crw s -d
```
   
When your Theme is ready and you want to try it with the CMS in a production environment, your need to build it. Same as `next build`:
```
npx cromwell build
```
Or via shortcut:
```
npx crw b
```
Now you can go into Admin panel > Themes > click "Set active" on your Theme card. It will change active CMS Theme at [http://localhost:4016/](http://localhost:4016/)


### Pre-build phase

This is a multipurpose phase that happens before we run Webpack compiler of Next.js.

1. Cromwell CMS needs to generate meta info files on your source code. In order to parse your files, we need to transpile them into plain JavaScript first.

2. We need to generate Admin panel bundles. That adds ability for each page to be opened and modified in Admin panel Theme Editor. Pre-build phase generates one bundle per configured page in cromwell.config.js. For now, to optimize performance these files generated only in production build mode, but not in watch mode.

3. We make your Frontend dependencies available to re-use for Plugins. See [Frontend dependencies](#todo) page for details.


### Customize bundler

We use [Rollup](https://rollupjs.org) for the pre-build phase. Which means you need to change Rollup config if you want to customize your build. The purpose of the phase is to build plain JavaScript, so you won't need to customize Next.js Webpack config.  

By default CMS build command can transpile React and handle CSS/SASS (by passing stylesheets to Next.js).  
After generating Theme template with Cromwell CLI, you will also have TypeScript support in the build config.

Open `cromwell.config.js`. You can see there's `rollupConfig` function that returns the configuring object: 
```JavaScript
{
    main: RollupConfig,
    adminPanel: RollupConfig
}
```
Usually `RollupConfig` is an object that exported from a [Rollup Config File](https://rollupjs.org/guide/en/#configuration-files). But we need to use different configs, so we return them in the `rollupConfig` labeled by properties.
- `main` - The config used by default for all bundles.
- `adminPanel` - The config that replaces `main` only for Admin panel page bundles.

You see the difference in configs because your Theme frontend will be passed further to the Next.js, but Admin panel page bundles will not. Files generated by `adminPanel` config will be executed in the browser, that's why we have `terser` and `postcss` plugin in this config.  

